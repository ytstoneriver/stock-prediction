# 日本株短期上昇銘柄発掘モデル PoC計画

## 目的
東証プライム銘柄から「20営業日以内に+10%上昇が期待できる銘柄」を日次ランキングし、
買いのみの戦略で利益が出るか検証する。

---

## 確定事項

| 項目 | 内容 |
|------|------|
| 対象市場 | 東証プライム |
| ユニバース | 株価300〜10,000円、売買代金≥1億円/日、出来高≥10万株/日 |
| データソース | yfinance |
| 学習期間 | 2022-01-01 〜 2023-12-31（2年） |
| 検証期間 | 2024-01-01 〜 現在 |
| ラベル | 20営業日以内に高値+10%到達 → 1、それ以外 → 0 |
| 運用想定 | 100万円、最大2銘柄、各50万円、翌日寄り固定 |
| 評価優先 | 戦略損益（総損益、勝率、最大DD） |

---

## 要検証事項

後回しにせず、Phase 1〜3の中で順次確認する。

| 項目 | 初期設定 | 検証方法 |
|------|----------|----------|
| positive_rate | +10%/20日 | Phase 1で実測。5%未満なら+8%に調整 |
| 地合いフィルタ | なし | Phase 3でフィルタあり/なしを比較 |
| 損切り | -1.5×ATR14 | Phase 3で固定%と比較（-5%等） |
| スコア閾値θ | なし | Phase 3で効果検証 |

---

## 実装フェーズ

### Phase 1: データ取得とラベル確認

**やること**
1. 東証プライム銘柄リスト取得
2. yfinanceで日足OHLCV取得（2022-01-01〜現在）
3. TOPIXデータ取得
4. ユニバースフィルタ適用（流動性）
5. ラベル生成（+10%到達判定）
6. positive_rateを算出

**確認すること**
- ユニバース銘柄数（目安: 300〜800銘柄/日）
- positive_rate（目安: 5%以上）
- データ欠損の有無

**判断基準**
| positive_rate | 対応 |
|---------------|------|
| ≥10% | そのまま継続 |
| 5〜10% | 継続（class_weight調整） |
| <5% | 閾値を+8%に下げて再計算 |

---

### Phase 2: 特徴量とモデル学習

**やること**
1. 特徴量生成
   - 価格系: 1/5/20日リターン、MA乖離、52週高値距離
   - 出来高系: 出来高異常度、売買代金異常度
   - ローソク足: 実体比率、ヒゲ比率、ギャップ
   - 地合い: TOPIXリターン、ボラ
2. LightGBMで学習（時系列分割）
3. 検証期間でスコア算出

**確認すること**
- AUC（参考: 0.55以上なら継続）
- 特徴量重要度（何が効いているか）
- スコア分布（正例/負例で分離しているか）

---

### Phase 3: バックテスト

**やること**
1. 売買ルール実装
   - エントリー: 翌日寄り
   - 利確: +10%（高値到達）
   - 損切: -1.5×ATR14（安値到達）
   - 時間切れ: 20営業日で終値決済
2. バックテスト実行（フィルタなし）
3. 地合いフィルタあり版でバックテスト
4. 比較検証

**評価指標**
- 総損益、CAGR
- 勝率、平均利益/平均損失
- 最大ドローダウン
- トレード数、投資日数比率

**判断基準**
| 結果 | 対応 |
|------|------|
| 総損益 > 0、勝率 ≥ 50% | 成功。パラメータ微調整へ |
| 総損益 < 0、勝率 ≥ 45% | 損切り/利確調整で改善余地あり |
| 勝率 < 40% | モデル・特徴量の見直し |

---

## ディレクトリ構成

```
src/
├── data/
│   ├── loader.py          # yfinanceデータ取得
│   └── universe.py        # 銘柄リスト・フィルタ
├── features/
│   └── builder.py         # 特徴量生成
├── model/
│   ├── labels.py          # ラベル生成
│   └── trainer.py         # LightGBM学習・予測
├── backtest/
│   └── engine.py          # バックテストエンジン
├── config.py              # パラメータ設定
└── main.py                # CLI
```

---

## パラメータ設定（config.py）

```python
# 変更可能なパラメータ
LABEL_TARGET_RETURN = 0.10      # +10%
LABEL_HORIZON_DAYS = 20         # 20営業日
TAKE_PROFIT = 0.10              # 利確+10%
STOP_LOSS_ATR_MULT = 1.5        # 損切り ATR倍率
MAX_HOLD_DAYS = 20              # 最大保有期間
TOP_N = 2                       # 上位N銘柄
CAPITAL = 1_000_000             # 運用資金
```

---

## 次のアクション

**Phase 1 開始**
1. 東証プライム銘柄リストを取得
2. yfinanceでデータ取得
3. positive_rate確認

→ 結果を見て継続判断
