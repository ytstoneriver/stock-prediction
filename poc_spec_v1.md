# 日本株短期上昇銘柄発掘モデル PoC v1 仕様書（Claude Code用）

## 1. 目的
東証プライム銘柄を対象に、機械学習で「数週間以内に10%前後の上昇が期待できる銘柄」を日次でランキングし、
買いのみのルールベース戦略でバックテスト可能なパイプラインを構築する。

PoCでは「銘柄を当てる」よりも、
- 取りやすい上昇が出やすい局面を抽出する
- 買うべき銘柄を相対順位で選別する
ことを重視する。

---

## 2. 前提条件（運用想定）
- 対象市場：東証プライムのみ
- 売買：買いのみ（信用売りなし）
- 運用資金：100万円
- 最大同時保有数：2銘柄
- 1銘柄あたり投資額：50万円前後（等金額）
- エントリー：翌営業日の寄り（寄り固定）
- 最大保有期間：20営業日（約1ヶ月）

---

## 3. ユニバース定義（流動性フィルタ）
スリッページや約定困難を避けるため、日次で以下フィルタを適用する。

- 株価：300円〜10,000円
- 直近20営業日平均
  - 売買代金（終値×出来高） ≥ 1億円 / 日
  - 出来高 ≥ 10万株 / 日

※ユニバースは毎営業日更新する。

---

## 4. 必要データ
### 4.1 株価データ（日足OHLCV）
対象銘柄について以下を用意する：
- 日付, 始値(Open), 高値(High), 安値(Low), 終値(Close), 出来高(Volume)

※株式分割などの調整後価格が用意できるなら望ましい（PoCでは未調整でも可）

### 4.2 市場指数（地合い判定）
- TOPIX（日足OHLCVまたは終値）
- 地合いフィルタに利用する

### 4.3 取引カレンダー
- 日本市場の営業日カレンダー（祝日等を考慮）

---

## 5. 予測ターゲット（ラベル定義）
### 5.1 分類ラベル（上昇到達型）
各銘柄の各日tについて：

- 基準価格：Close[t]
- 未来20営業日（t+1〜t+20）を観測
- 未来期間中の高値が +10% 以上到達したら 1、それ以外は0

定義：
`label[t] = 1 if max(High[t+1:t+20]) / Close[t] - 1 >= 0.10 else 0`

※「終値で+10%」ではなく「途中で利確できる+10%」を捉える目的で高値判定を採用する。

---

## 6. 特徴量設計（入力）
リーク防止のため、特徴量は「t日までの情報のみ」で作る。

### 6.1 価格・トレンド系
- 1日/5日/20日リターン（終値）
- 移動平均乖離：
  - Close/MA5 - 1
  - Close/MA25 - 1
- 直近20日高値との距離：
  - Close / max(High[t-19:t]) - 1

### 6.2 出来高・売買代金系（最重要）
- 出来高異常度：
  - Volume[t] / mean(Volume[t-19:t])
- 売買代金（turnover）：
  - turnover[t] = Close[t] * Volume[t]
- 売買代金異常度：
  - turnover[t] / mean(turnover[t-19:t])

### 6.3 ローソク足形状
- 実体比率：
  - abs(Close-Open)/(High-Low)
- 上ヒゲ比率：
  - (High - max(Open,Close)) / (High-Low)
- 下ヒゲ比率：
  - (min(Open,Close) - Low) / (High-Low)
- ギャップ：
  - Open[t]/Close[t-1] - 1

### 6.4 地合い特徴量（TOPIX）
- TOPIX 1日/5日リターン
- TOPIX 10日ボラ（rolling std等）

---

## 7. モデル設計
### 7.1 学習モデル
- LightGBM 等の勾配ブースティング系を第一候補とする
- 出力は確率（またはスコア）とし、日次で銘柄をランキングする用途に使う

### 7.2 バリデーション
- 時系列分割（walk-forward）を採用
- シャッフルは禁止（未来情報リーク防止）

---

## 8. 売買ルール（バックテスト仕様）
### 8.1 銘柄選択
各日tの引け後に：
1. ユニバース作成
2. 特徴量計算
3. モデルでスコア算出
4. 地合いフィルタを判定
5. 取引可能ならスコア上位2銘柄を選定
6. 翌営業日寄りでエントリー（寄り固定）

### 8.2 ノートレ条件（地合いフィルタ）
新規エントリーを禁止する条件：
- TOPIX Close[t] < TOPIX MA25[t] の日は新規買いを行わない

※既存保有の決済は通常通り行う。

### 8.3 イグジット（トリプルバリア）
エントリー価格 = 翌営業日の Open[entry_day] として以下で決済する。

- 利確：+10%
  - High が entry_price * 1.10 に到達したら決済
- 損切：-1.5 × ATR(14)
  - Low が entry_price - 1.5*ATR14 以下なら決済
- 時間切れ：最大20営業日
  - 20営業日経過で終値決済

※ATR(14)は標準的なTrue Rangeから計算する。

---

## 9. 評価指標
### 9.1 モデル評価
- AUC / Logloss（参考）
- Precision@2（上位2銘柄の当たり率）
- 上位2銘柄のうち「少なくとも1銘柄が+10%到達」する割合

### 9.2 戦略評価
- 総損益、CAGR
- 勝率、平均利益、平均損失、期待値
- 最大ドローダウン
- 投資比率（どれくらいの日でポジションを持つか）
- 手数料・スリッページ感度

---

## 10. 実装モジュール案（タスク分割）
- data_loader：日足OHLCV取得・保存
- universe：流動性フィルタ適用
- features：特徴量生成
- labels：未来20日 +10%ラベル生成
- model：学習・保存・スコアリング
- backtest：売買ルールで損益計算
- report：評価指標・グラフ・日次ランキング出力（CSV）

---

## 11. パラメータ（後で調整）
- 利確：+10%
- 損切：-1.5 × ATR(14)
- 最大保有期間：20営業日
- 地合いフィルタ：TOPIX MA25
- 上位採用数：2銘柄
- 取引コスト（手数料＋スリッページ）は設定可能にする
