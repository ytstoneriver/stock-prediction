# 改善候補（高確度）

以下は「短期シグナルのMLで高確度に効く」と一般的に支持される要素に限定した候補。
コードは変更せず、候補のみを列挙する。
各項目は「目的」「具体案」「期待効果」「注意点」「情報ソース」を明記する。
ソースは「実務で広く採用」「学術的に繰り返し確認」の双方を意識し、根拠が弱いものは除外。

## 1) 市場調整リターン（超過リターン）
- 目的: 市場全体の動きを差し引いた短期の個別超過分を捉える
- 具体案:
  - 1日・5日リターンを市場指数（TOPIX）で調整した値を特徴量として扱う
  - 既存の市場特徴量と併用し、個別要因と市場要因を分離
- 具体例:
  - `超過リターン = 個別リターン - 市場リターン`
  - `短期 = 1d/5d、長期 = 20d` の3種類を比較し、短期だけ採用
- 期待効果:
  - 短期クロスセクションで「個別の異常リターン」を強く拾える
  - 市場急変時に、全体の動きに引きずられる誤検知を減らせる
- 注意点:
  - 市場指数の取得が安定していることが前提
  - 既存のリターン特徴量との重複を避けるため、役割を明確化する
- 情報ソース:
  - Intraday Stock Predictability Everywhere（短期のクロスセクション予測で超過リターンの情報が強い）
    - https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4496917
  - Intraday Market Predictability: A Machine Learning Approach（市場全体と個別の分離が有効）
    - https://ideas.repec.org/a/oup/jfinec/v21y2023i2p485-527..html

## 2) 期待利益を中心にした評価軸の統一
- 目的: AUCより売買ルールに沿った収益性を最優先で評価する
- 具体案:
  - モデル選定・閾値調整の判断基準を期待利益中心に統一
  - Precision@1などの指標は補助に回す
- 具体例:
  - 期待利益の比較を「月次ローリングの平均」で統一
  - 期待利益が近い場合はPrecision@1で優先順位付け
- 期待効果:
  - 「精度は高いが利益が薄い」状態を避けられる
  - 短期売買のトレードオフを最適化しやすくなる
- 注意点:
  - 期待利益はサンプル数が少ないとブレやすい
  - 評価期間を固定し、比較の一貫性を保つ必要がある
- 情報ソース:
  - トリプルバリア/イベントラベリングの考え方（収益と精度の乖離を前提に評価する必要）
    - https://www.sciencedirect.com/science/article/pii/S0304405X18301326

## 3) 流動性代理特徴の強化
- 目的: 短期の予測性に強く影響する流動性の違いをモデルに反映
- 具体案:
  - 出来高や売買代金の「変化率」「相対順位」「異常度」を特徴量化
  - 直近の流動性変化が急な銘柄を識別できる指標を追加
- 具体例:
  - `当日売買代金 / 20日平均売買代金`
  - `出来高の20日内順位（分位）`
- 期待効果:
  - 同じ価格パターンでも「取引のしやすさ」を区別できる
  - 高流動性銘柄の短期モメンタムと低流動性の反転傾向を分離しやすい
- 注意点:
  - フィルタとして使うと過去に失敗しているため「特徴量として扱う」に留める
  - 追加する特徴量数は少数に抑え、過学習を避ける
- 情報ソース:
  - Short-term reversals, short-term momentum, and news-driven trading activity
    - https://www.sciencedirect.com/science/article/abs/pii/S0378426621000261
  - Intraday Stock Predictability Everywhere（流動性依存の予測性）
    - https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4496917

## 4) リターンの非対称性特徴
- 目的: 上昇優位/下落優位の偏りを数値化して短期の反転/継続を見分ける
- 具体案:
  - 期間内の「負リターン比率」「下方リターンの標準偏差」などを特徴量化
  - リターンの歪度に近い指標で「下落優位/上昇優位」を表現
- 具体例:
  - `負リターン日数 / 期間日数`
  - `下方リターンの標準偏差 / 全体の標準偏差`
- 期待効果:
  - 単純なボラだけでは捉えられない方向性の偏りを補える
  - 短期の反転狙い/継続狙いの判断材料が増える
- 注意点:
  - 期間窓を短めにして情報の鮮度を保つ
  - 追加特徴量はTop N選択で自動的に淘汰させる前提
- 情報ソース:
  - The Predictive Power of Inter-trade Durations: Return Reversals and Momentum
    - https://papers.ssrn.com/sol3/papers.cfm?abstract_id=5133531
  - Reversal in stock returns（短期反転の特徴に関する古典的研究）
    - https://www3.nd.edu/~zda/Reversal.pdf

## 5) イベント近接性（決算など）
- 目的: 重要イベント周辺の価格反応を捉える
- 具体案:
  - 決算日までの残日数をダミー化（例: 前後3営業日）
  - イベント前後の「不連続な値動き」を特徴量に反映
- 具体例:
  - `決算前3営業日 = 1 / それ以外 = 0`
  - `決算翌営業日のギャップ率`
- 期待効果:
  - イベント由来の短期異常リターンを捉えやすい
  - イベント期の誤検知（通常期と同じ扱い）を減らせる
- 注意点:
  - 外部データの安定取得が前提
  - データ欠損時は特徴量を無効化する設計が必要
- 情報ソース:
  - Short-term reversals, short-term momentum, and news-driven trading activity（イベント近接と短期リターン）
    - https://www.sciencedirect.com/science/article/abs/pii/S0378426621000261

---

## 検証結果サマリー（2026-01-26実施）

### ベースライン
- 取引回数: 20回
- 勝率: 65.0%
- 損益: +¥557,385
- PF: 1.84

### 候補1: 市場調整リターン（超過リターン）
- **結果: 悪化**
- 追加した特徴量: `feat_excess_ret_1d`, `feat_excess_ret_5d`
- 取引回数: 29回、勝率: 44.8%、損益: -¥350,975、PF: 0.78
- 考察: 日経225で調整したが、個別株の超過リターンがノイズとして作用した可能性

### 候補2: 期待利益を中心にした評価軸の統一
- **結果: スキップ**（コード変更不要のため）

### 候補3: 流動性代理特徴の強化
- **結果: 悪化**
- 追加した特徴量: `feat_volume_rank_20d`, `feat_turnover_change_5d`
- 取引回数: 34回、勝率: 50.0%、損益: -¥60,198、PF: 0.96
- 考察: 既存の出来高特徴量（feat_volume_ratio_5d/20d等）と重複し、冗長な情報がノイズに

### 候補4: リターンの非対称性特徴
- **結果: 悪化**
- 追加した特徴量: `feat_neg_ret_ratio_20d`, `feat_downside_vol_ratio`
- 取引回数: 37回、勝率: 37.8%、損益: -¥892,766、PF: 0.59
- 考察: 下方リスク情報は既存のボラティリティ特徴量（feat_volatility_20d, feat_atr_pct）でカバー済み

### 候補5: イベント近接性（決算など）
- **結果: スキップ**（外部データが必要のため）

### 教訓
1. **特徴量追加は逆効果になりやすい**: 現在のTop 20選択で十分最適化されている
2. **既存特徴量と重複する情報は避ける**: 特にボラティリティ・出来高系は既にカバー済み
3. **市場調整は必ずしも有効ではない**: 日本株市場では個別株リターンをそのまま使う方が良い結果
4. **特徴量数47個の制約を守る**: CLAUDE.mdの教訓「特徴量を増やしすぎない」が再確認された
